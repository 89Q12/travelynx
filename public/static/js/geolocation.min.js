$(document).ready(function(){function i(){return $("div.geolocation div.progress")}function e(e){$.post("/geolocation",{lon:e.coords.longitude,lat:e.coords.latitude},o)}function t(e){e.code==e.PERMISSION_DENIED?n("Standortanfrage nicht möglich.","Vermutlich fehlen die Rechte im Browser oder der Android Location Service ist deaktiviert.","geolocation.error.PERMISSION_DENIED"):e.code==e.POSITION_UNAVAILABLE?n("Standort konnte nicht ermittelt werden","(Service nicht verfügbar)","geolocation.error.POSITION_UNAVAILABLE"):e.code==e.TIMEOUT?n("Standort konnte nicht ermittelt werden","(Timeout)","geolocation.error.TIMEOUT"):n("Standort konnte nicht ermittelt werden","(unbekannter Fehler)","unknown geolocation.error code")}const n=function(e,t,n){var o=$(document.createElement("div")),t=(o.attr("class","error"),o.text(t),$(document.createElement("strong"))),e=(t.text(e+" "),o.prepend(t),$("div.geolocation").append(o),$("div.geolocation").data("recent"));if(e){t=e.split("|");const r=$(document.createElement("p"));$.each(t,function(e,t){t=t.split(";");r.append($('<a class="tablerow" href="/s/'+t[0]+'"><span>'+t[1]+"</span></a>"))}),$("p.geolocationhint").text("Letzte Ziele:"),i().replaceWith(r)}else i().remove()},o=function(e){if(e.error)n("Backend-Fehler:",e.error,null);else if(0==e.candidates.length)n("Keine Bahnhöfe in 70km Umkreis gefunden","",null);else{const r=$(document.createElement("p"));$.each(e.candidates,function(e,t){var n=t.ds100,o=t.name;t.distance.toFixed(1);r.append($('<a class="tablerow" href="/s/'+n+'"><span>'+o+"</span></a>"))}),i().replaceWith(r)}},r=$("div.geolocation > button");r.data("recent");function a(){r.replaceWith($('<p class="geolocationhint">Stationen in der Umgebung:</p><div class="progress"><div class="indeterminate"></div></div>')),navigator.geolocation.getCurrentPosition(e,t)}r.length&&(navigator.geolocation?navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(function(e){"prompt"===e.state?r.on("click",a):a()}):r.on("click",a):n("Standortanfragen werden von diesem Browser nicht unterstützt","",null))});
