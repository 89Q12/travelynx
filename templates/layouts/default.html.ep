<!DOCTYPE html>
<html lang="de">
<head>
	<title><%= stash('title') // 'travelynx' %></title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#673ab7">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-title" content="Weather PWA">
	% my $av = 'v11'; # asset version
	<link rel="apple-touch-icon" href="/static/<%= $av %>/icons/icon-152x152.png">
	<link rel="manifest" href="/static/<%= $av %>/manifest.json">
	%= stylesheet "/static/${av}/css/materialize.min.css"
	%= stylesheet "/static/${av}/css/material-icons.css"
	%= stylesheet "/static/${av}/css/local.css"
	%= javascript "/static/${av}/js/jquery-2.2.4.min.js"
	%= javascript "/static/${av}/js/materialize.min.js"
	%= javascript "/static/${av}/js/travelynx-actions.min.js"
	% if (stash('with_geolocation')) {
		%= javascript "/static/${av}/js/geolocation.min.js"
	% }
	% if (stash('with_autocomplete')) {
		%= javascript "/static/${av}/js/autocomplete.min.js"
	% }
</head>
<body>

<nav class="deep-purple">
	<div class="nav-wrapper container">
		<a href="/" class="brand-logo left">travelynx</a>
		<ul id="nav-mobile" class="right">
			% if (is_user_authenticated()) {
				<li class="<%= navbar_class('/history') %>"><a href='/history' title="History"><i class="material-icons">history</i></a></li>
				<li class="<%= navbar_class('/account') %>"><a href="/account" title="Account"><i class="material-icons">account_circle</i></a></li>
			% }
			<li class="<%= navbar_class('/about') %>"><a href='/about' title="About"><i class="material-icons">info_outline</i></a></li>
		</ul>
	</div>
</nav>

% if (app->mode eq 'development') {
<div class="container">
	<div class="row">
		<div class="col s12 red darken-4 white-text">
			Development Mode â€“ Datenbank: <%= app->config->{db}->{database} %>
			@ <%= app->config->{db}->{host} %>
		</div>
	</div>
</div>
% }

<div class="container">
	% if (is_user_authenticated()) {
		% my $acc = current_user();
		% if ($acc and $acc->{deletion_requested}) {
			%= include '_deletion_note', timestamp => $acc->{deletion_requested}
		% }
	% }
	%= content
</div>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
        .then((reg) => {
          console.log('Service worker registered.', reg);
        });
  });
}
</script>

</body>
</html>
